{% extends "layout.html" %}

{% block content %}
<div class="px-4 py-5 my-5 text-center">
    <h1 class="display-5 fw-bold">Bem-vindo, {{ current_user.full_name or current_user.username }}!</h1>
    <div class="col-lg-6 mx-auto">
        <p class="lead mb-4">Você está no sistema de controle térmico para bezerros.</p>
    </div>
</div>

{% if current_user.role == 'admin' %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card text-center mb-4">
            <div class="card-header">
                Status Geral do Ambiente
            </div>
            <div class="card-body bg-{{ status_cor }} text-white">
                <h2 class="card-title">{{ status_geral }}</h2>
                <p class="card-text fs-4">
                    <i class="bi bi-thermometer-sun"></i> Temperatura: <strong>{{ temp_atual }} °C</strong>
                    &nbsp;&nbsp;&nbsp;
                    <i class="bi bi-droplet-half"></i> Umidade: <strong>{{ umid_atual }} %</strong>
                </p>
            </div>

        </div>
    </div>
</div>
{% endif %}

<div class="row justify-content-center">
    <div class="col-md-8">
        <h3>Sobre o Projeto</h3>
        <p>DESCRICAO DO SISTEMA **ESCREVER**</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Guarda os valores iniciais que foram renderizados na página
        const initialTemp = '{{ temp_atual }}';
        const initialHum = '{{ umid_atual }}';

        const checkForUpdates = async () => {
            try {
                const response = await fetch('/api/live_status');
                const liveData = await response.json();

                // Compara os dados atuais da API com os dados iniciais da página
                // Se algum valor de sensor relevante mudou, recarrega a página.
                if (liveData.temperature && (liveData.temperature !== initialTemp || liveData.umidade !== initialHum)) {
                    console.log('Novos dados de sensores detectados. Recarregando...');
                    window.location.reload();
                }

            } catch (error) {
                console.error('Erro ao verificar atualizações:', error);
            }
        };

        // Verifica por atualizações a cada 7 segundos
        setInterval(checkForUpdates, 7000);
    });
</script>
{% endblock %}